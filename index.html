<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© - Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fa;
            color: #333;
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        
        .print-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(to right, #2c5f2d, #1e3a28);
            color: white;
            padding: 25px;
            text-align: center;
            border-bottom: 4px solid #ffcc00;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .info-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .info-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .info-box h3 {
            color: #2c5f2d;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #2c5f2d;
            font-size: 18px;
        }
        
        .content {
            padding: 30px;
        }
        
        .store-info {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #2c5f2d;
        }
        
        .store-info h2 {
            color: #1e3a28;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .store-details {
            display: inline-flex;
            gap: 30px;
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }
        
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            font-size: 14px;
        }
        
        .items-table th {
            background: #2c5f2d;
            color: white;
            padding: 12px 10px;
            text-align: right;
            font-weight: bold;
        }
        
        .items-table td {
            padding: 10px;
            border: 1px solid #dee2e6;
            text-align: right;
        }
        
        .items-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .total-box {
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #2c5f2d;
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .total-label {
            font-size: 20px;
            color: #1e3a28;
            font-weight: bold;
        }
        
        .total-amount {
            font-size: 32px;
            font-weight: 900;
            color: #2c5f2d;
        }
        
        .actions {
            text-align: center;
            padding: 25px;
            background: #f8f9fa;
            border-top: 2px solid #e9ecef;
        }
        
        .print-btn {
            background: linear-gradient(to right, #2c5f2d, #1e3a28);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .print-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(44, 95, 45, 0.4);
        }
        
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            color: #856404;
            font-size: 14px;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-size: 14px;
            border-top: 1px solid #e9ecef;
            background: #f8f9fa;
        }
        
        @media print {
            body {
                background: white !important;
                padding: 0 !important;
            }
            
            .print-container {
                box-shadow: none !important;
                margin: 0 !important;
                max-width: 100% !important;
            }
            
            .actions, .instructions, .footer {
                display: none !important;
            }
            
            .print-btn {
                display: none !important;
            }
            
            @page {
                margin: 0.5cm;
            }
        }
        
        @media (max-width: 768px) {
            .print-container {
                margin: 10px;
            }
            
            .info-section {
                grid-template-columns: 1fr;
            }
            
            .store-details {
                flex-direction: column;
                gap: 10px;
            }
            
            .items-table {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="print-container">
        <div class="header">
            <h1 id="document-title">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h1>
            <p id="document-subtitle">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>
        </div>
        
        <div class="info-section">
            <div class="info-box">
                <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªÙ†Ø¯</h3>
                <p><strong>Ø±Ù‚Ù…:</strong> <span id="doc-number">#0000</span></p>
                <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> <span id="doc-date">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
                <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> <span id="doc-type">ÙØ§ØªÙˆØ±Ø©</span></p>
            </div>
            
            <div class="info-box">
                <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
                <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> <span id="client-name">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
                <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> <span id="client-phone">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
                <p><strong>Ø§Ù„Ø±ØµÙŠØ¯:</strong> <span id="client-balance">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
            </div>
        </div>
        
        <div class="content">
            <div class="store-info" id="store-info">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            </div>
            
            <div id="document-content">
                <p style="text-align:center; padding:40px; color:#6c757d;">
                    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªÙ†Ø¯...
                </p>
            </div>
            
            <div class="total-box" id="total-box">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            </div>
        </div>
        
        <div class="actions">
            <button class="print-btn" onclick="printNow()">
                <span>ğŸ–¨ï¸</span>
                Ø·Ø¨Ø§Ø¹Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙ†Ø¯
            </button>
            
            <div class="instructions">
                <p><strong>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©:</strong></p>
                <p>1. Ø§Ø¶ØºØ· Ø²Ø± "Ø·Ø¨Ø§Ø¹Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙ†Ø¯" Ø£Ø¹Ù„Ø§Ù‡</p>
                <p>2. Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… <strong>Ctrl + P</strong> Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</p>
                <p>3. ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„: â‹® â†’ Ù…Ø´Ø§Ø±ÙƒØ© â†’ Ø·Ø¨Ø§Ø¹Ø©</p>
            </div>
        </div>
        
        <div class="footer">
            <p>ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>
            <p>Â© 2025 - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
        </div>
    </div>

    <script>
        // === Ø¯Ø§Ù„Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ===
        function getUrlData(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name);
        }

        // === ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===
        document.addEventListener('DOMContentLoaded', function() {
            const type = getUrlData('type') || 'invoice';
            const dataParam = getUrlData('data');
            
            if (dataParam) {
                try {
                    // ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    const decodedData = decodeURIComponent(dataParam);
                    const documentData = JSON.parse(decodedData);
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    displayDocument(type, documentData);
                    
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
                    setTimeout(() => {
                        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¢Ù†ØŸ')) {
                            printNow();
                        }
                    }, 1500);
                    
                } catch (error) {
                    showError('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
                }
            } else {
                showError('Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
            }
        });

        // === Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ ===
        function displayDocument(type, data) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            const title = type === 'invoice' ? 'ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹' : 'ÙƒØ´Ù Ø­Ø³Ø§Ø¨';
            document.getElementById('document-title').textContent = title;
            document.getElementById('document-subtitle').textContent = 
                data.storeInfo?.name || 'Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©';
            document.getElementById('doc-type').textContent = title;
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ù„
            displayStoreInfo(data.storeInfo);
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            if (type === 'invoice') {
                displayInvoice(data);
            } else if (type === 'statement') {
                displayStatement(data);
            }
        }

        // === Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ù„ ===
        function displayStoreInfo(storeInfo) {
            const storeDiv = document.getElementById('store-info');
            
            if (!storeInfo) {
                storeDiv.innerHTML = '<h2>Ø§Ù„Ù…Ø­Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</h2>';
                return;
            }
            
            let html = `<h2>${storeInfo.name || 'Ø§Ù„Ù…Ø­Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ'}</h2>`;
            
            if (storeInfo.desc) {
                html += `<p style="color:#666; margin:5px 0;">${storeInfo.desc}</p>`;
            }
            
            if (storeInfo.contact || storeInfo.address) {
                html += `<div class="store-details">`;
                
                if (storeInfo.contact) {
                    html += `<span>ğŸ“ ${storeInfo.contact}</span>`;
                }
                
                if (storeInfo.address) {
                    html += `<span>ğŸ“ ${storeInfo.address}</span>`;
                }
                
                html += `</div>`;
            }
            
            storeDiv.innerHTML = html;
        }

        // === Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ===
        function displayInvoice(data) {
            // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªÙ†Ø¯
            document.getElementById('doc-number').textContent = '#' + (data.id || '0001');
            document.getElementById('doc-date').textContent = data.date || new Date().toLocaleDateString('ar-YE');
            document.getElementById('client-name').textContent = data.customerName || 'Ø²Ø¨ÙˆÙ†';
            document.getElementById('client-phone').textContent = data.customerPhone || data.paymentMethod === 'cash' ? 'Ù†Ù‚Ø¯ÙŠ' : 'Ø¹Ù„Ù‰ Ø§Ù„Ø±ØµÙŠØ¯';
            document.getElementById('client-balance').textContent = 
                data.customerBalance ? data.customerBalance + ' Ø±.ÙŠ' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            let tableHTML = '';
            let total = 0;
            
            if (data.items && data.items.length > 0) {
                tableHTML = `
                    <table class="items-table">
                        <thead>
                            <tr>
                                <th width="5%">#</th>
                                <th width="45%">Ø§Ù„Ù…Ù†ØªØ¬</th>
                                <th width="15%">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th width="15%">Ø§Ù„Ø³Ø¹Ø±</th>
                                <th width="20%">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                data.items.forEach((item, index) => {
                    const itemTotal = (item.price || 0) * (item.quantity || 1);
                    total += itemTotal;
                    
                    tableHTML += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${item.name || 'Ù…Ù†ØªØ¬'}</td>
                            <td>${item.quantity || 1}</td>
                            <td>${(item.price || 0).toFixed(2)} Ø±.ÙŠ</td>
                            <td>${itemTotal.toFixed(2)} Ø±.ÙŠ</td>
                        </tr>
                    `;
                });
                
                tableHTML += `
                        </tbody>
                    </table>
                `;
            } else {
                tableHTML = '<p style="text-align:center; color:#666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±</p>';
            }
            
            document.getElementById('document-content').innerHTML = tableHTML;
            
            // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ
            const finalTotal = data.total || total;
            document.getElementById('total-box').innerHTML = `
                <div class="total-label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</div>
                <div class="total-amount">${finalTotal.toFixed(2)} Ø±.ÙŠ</div>
            `;
        }

        // === Ø¹Ø±Ø¶ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ ===
        function displayStatement(data) {
            // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªÙ†Ø¯
            document.getElementById('doc-number').textContent = '#STA' + (data.id || '001');
            document.getElementById('doc-date').textContent = data.date || new Date().toLocaleDateString('ar-YE');
            document.getElementById('client-name').textContent = data.customerName || 'Ø¹Ù…ÙŠÙ„';
            document.getElementById('client-phone').textContent = data.customerPhone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            document.getElementById('client-balance').textContent = (data.currentBalance || 0) + ' Ø±.ÙŠ';
            
            // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
            let tableHTML = '';
            
            if (data.transactions && data.transactions.length > 0) {
                tableHTML = `
                    <h3 style="color:#1e3a28; margin-bottom:15px;">Ø­Ø±ÙƒØ© Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
                    <table class="items-table">
                        <thead>
                            <tr>
                                <th width="5%">#</th>
                                <th width="20%">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th width="35%">Ø§Ù„ÙˆØµÙ</th>
                                <th width="20%">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th width="20%">Ø§Ù„Ø±ØµÙŠØ¯</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                data.transactions.forEach((trans, index) => {
                    const amount = trans.amount || 0;
                    const isDeposit = trans.type === 'deposit';
                    
                    tableHTML += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${trans.date || '--'}</td>
                            <td>${trans.description || (isDeposit ? 'Ø¥ÙŠØ¯Ø§Ø¹' : 'Ø³Ø­Ø¨')}</td>
                            <td style="color: ${isDeposit ? '#28a745' : '#dc3545'}; font-weight:bold;">
                                ${isDeposit ? '+' : '-'} ${amount.toFixed(2)} Ø±.ÙŠ
                            </td>
                            <td>${(trans.balance || 0).toFixed(2)} Ø±.ÙŠ</td>
                        </tr>
                    `;
                });
                
                tableHTML += `
                        </tbody>
                    </table>
                `;
            } else {
                tableHTML = '<p style="text-align:center; color:#666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</p>';
            }
            
            document.getElementById('document-content').innerHTML = tableHTML;
            
            // Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            const balance = data.currentBalance || 0;
            const isPositive = balance >= 0;
            
            document.getElementById('total-box').innerHTML = `
                <div class="total-label">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
                <div class="total-amount" style="color: ${isPositive ? '#28a745' : '#dc3545'}">
                    ${isPositive ? '' : '-'} ${Math.abs(balance).toFixed(2)} Ø±.ÙŠ
                </div>
            `;
        }

        // === Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ===
        function printNow() {
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø©
            const msg = document.createElement('div');
            msg.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: #2c5f2d;
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                z-index: 10000;
                text-align: center;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            `;
            msg.innerHTML = 'ğŸ–¨ï¸ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©...';
            document.body.appendChild(msg);
            
            // Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
            setTimeout(() => {
                window.print();
                setTimeout(() => msg.remove(), 1000);
            }, 1000);
        }

        // === Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø·Ø£ ===
        function showError(message) {
            document.getElementById('document-content').innerHTML = `
                <div style="text-align:center; padding:50px;">
                    <div style="color:#dc3545; font-size:48px; margin-bottom:20px;">âš ï¸</div>
                    <h3 style="color:#dc3545;">Ø®Ø·Ø£</h3>
                    <p style="color:#666; margin:15px 0;">${message}</p>
                    <button onclick="window.history.back()" style="
                        background: #2c5f2d;
                        color: white;
                        border: none;
                        padding: 10px 25px;
                        border-radius: 5px;
                        cursor: pointer;
                        margin-top: 10px;
                    ">
                        Ø§Ù„Ø¹ÙˆØ¯Ø©
                    </button>
                </div>
            `;
            
            document.querySelector('.actions').style.display = 'none';
            document.getElementById('total-box').style.display = 'none';
        }
    </script>
</body>
</html>
